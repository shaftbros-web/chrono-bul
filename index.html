<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chrono Bulward v0.2.27 (modular)</title>
<style>
  body { margin:0; background:#222; color:#eee; font-family:monospace; text-align:center; }
  #gameCanvas { background:#333; display:none; margin:0 auto; border:2px solid #000; }
  #gameArea { position:relative; width:400px; margin:0 auto; display:none; }
  #speedBtn { position:absolute; top:10px; right:10px; padding:4px 8px; }
  #menu, #settings, #help { margin-top:20px; }
  h1 { margin:20px; }
  .unit-settings { border:1px solid #555; padding:10px; margin:10px auto; width:90%; max-width:420px; text-align:left; }
  input[type=range] { width:230px; }
  #ui { margin-top:10px; display:none; }
  #ui button { margin:5px; padding:8px 16px; font-size:14px; }
  .unit-btn {
    margin:5px;
    padding:8px 16px;
    font-size:14px;
    color:#eee;
    background:linear-gradient(#555, #333);
    border:1px solid #666;
    cursor:pointer;
    transition:background 0.3s, transform 0.05s;
  }
  .unit-btn:hover {
    background:linear-gradient(#666, #444);
  }
  .unit-btn:active,
  .unit-btn.pressed {
    background:linear-gradient(#333, #111);
    transform:translateY(2px);
  }

  .special-btn {
    margin:5px;
    padding:8px 16px;
    font-size:14px;
    color:#fff;
    background:linear-gradient(#1e88e5, #0d47a1);
    border:1px solid #0d47a1;
    cursor:pointer;
    transition:background 0.3s, transform 0.05s, box-shadow 0.3s;
    box-shadow:0 0 5px rgba(30,136,229,0.7);
  }
  .special-btn:hover {
    background:linear-gradient(#2196f3,#1565c0);
    box-shadow:0 0 8px rgba(30,136,229,1);
  }
  .special-btn:active,
  .special-btn.pressed {
    background:linear-gradient(#0d47a1,#002171);
    transform:translateY(2px);
    box-shadow:0 0 3px rgba(0,0,0,0.5) inset;
  }
  .special-btn.selected {
    box-shadow:0 0 12px gold;
  }
  .special-btn:disabled {
    background:#555;
    color:#999;
    border:1px solid #444;
    box-shadow:none;
    cursor:not-allowed;
  }
  #help, #settings, #changelog { display:none; text-align:left; max-width:700px; margin:20px auto; padding:12px; background:#111; border:1px solid #555; }
  @keyframes manaBlink {
    0%, 100% { filter: drop-shadow(0 0 2px gold); opacity:1; }
    50% { filter: drop-shadow(0 0 10px gold); opacity:0.6; }
  }
  progress.mana-full {
    animation: manaBlink 1s linear infinite;
    filter: drop-shadow(0 0 2px gold);
  }
  #freezeBar { accent-color: blue; }
  #freezeBar::-webkit-progress-value { background: blue; }
  #freezeBar::-moz-progress-bar { background: blue; }
  #meteorBar { accent-color: red; }
  #meteorBar::-webkit-progress-value { background: red; }
  #meteorBar::-moz-progress-bar { background: red; }
  #healBar { accent-color: green; }
  #healBar::-webkit-progress-value { background: green; }
  #healBar::-moz-progress-bar { background: green; }
</style>
</head>
<body>
<h1 id="title">Chrono Bulward v0.2.27 (modular)
  <button id="historyBtn" onclick="showChangelog()" style="margin-left:10px;">変更履歴</button>
</h1>

<div id="menu">
  <button onclick="startGame()">ゲーム開始</button>
  <button onclick="showSettings()">設定</button>
  <button onclick="showHelp()">説明</button>
</div>

<!-- 設定画面 -->
<div id="settings">
  <h2>ユニット調整</h2>
  <div id="unitSliders"></div>
  <div style="margin-top:8px;">
    <button onclick="backToMenu()">戻る</button>
    <button onclick="applySettingsAndStart()">ゲーム開始</button>
  </div>
</div>

<!-- 説明画面 -->
<div id="help">
  <h2>ゲームのルール</h2>
  <p>自陣（下）からユニットを召喚し、敵陣（上）から進行してくる敵を防ぎます。<br>
  ユニット同士が接触すると戦闘開始、どちらかが倒れるまで移動を停止して戦闘を続けます。</p>

  <h2>勝敗条件</h2>
  <ul>
    <li>敵ユニットが自陣に到達すると自陣HPが減少</li>
    <li>味方ユニットが敵陣に到達すると敵陣HPが減少</li>
    <li>どちらかのHPが0になると勝敗が決定</li>
  </ul>

  <h2>主要ユニット</h2>
  <ul>
    <li><b>ナイト</b>：近接。標準的な耐久と攻撃</li>
    <li><b>アーチャー</b>：遠距離。射程内を攻撃</li>
    <li><b>クレリック</b>：回復。射程内の味方を回復</li>
    <li><b>ゴブリン/オーク/ゴーレム</b>：敵の前衛</li>
    <li><b>シャーマン/ファントム</b>：敵の遠隔攻撃</li>
  </ul>

  <button onclick="backToMenuFromHelp()">戻る</button>
</div>

<!-- 変更履歴画面 -->
<div id="changelog">
  <h2>変更履歴</h2>
  <ul>
    <li>v0.2.27 モジュール化された構成。</li>
    <li>v0.2.26 UIやバランスの調整。</li>
  </ul>
  <button onclick="backToMenuFromChangelog()">戻る</button>
</div>

<div id="gameArea">
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <button id="speedBtn" onclick="toggleSpeed()">x1</button>
</div>

<div id="ui">
  <div id="goldDisplay">Gold: 500</div>
  <button class="unit-btn" data-unit="swordsman" onclick="chooseUnit('swordsman')">ナイト召喚</button>
  <button class="unit-btn" data-unit="archer" onclick="chooseUnit('archer')">アーチャー召喚</button>
  <button class="unit-btn" data-unit="healer" onclick="chooseUnit('healer')">クレリック召喚</button>
</div>

<!-- スペシャル攻撃 UI -->
<div id="specialUI" style="display:none; position:relative; margin-top:10px; background:#111; padding:10px; border-top:2px solid #555;">
  <div>
    <label>❄️ フリーズ</label>
    <progress id="freezeBar" value="0" max="100"></progress>
    <button id="freezeBtn" class="special-btn" onclick="useSpecial('freeze')" disabled>発動</button>
  </div>
  <div>
    <label>☄️ メテオ</label>
    <progress id="meteorBar" value="0" max="150"></progress>
    <button id="meteorBtn" class="special-btn" onclick="useSpecial('meteor')" disabled>発動</button>
  </div>
  <div>
    <label>✨ ヒーリング</label>
    <progress id="healBar" value="0" max="120"></progress>
    <button id="healBtn" class="special-btn" onclick="useSpecial('heal')" disabled>発動</button>
  </div>
</div>

  
<!-- スクリプト読み込み（順番に注意） -->
<script src="units.js" defer></script>
<script src="projectiles.js" defer></script>
<script src="ui.js" defer></script>
<script src="game.js" defer></script>
<!-- ★ 最後に読み込む -->
</body>
</html>
